---
title: <center> **Classificazione della salute del feto** <center>
author: <center> Bonanomi Gervasoni Mahhadi <center>
date: <center> 16 Gennaio 2024 <center>
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r warning=FALSE, message= FALSE,echo=FALSE }
library(tidyverse)
library(mclust)
library(Rmixmod)
library(GGally)
library(caret)
```

<center> 
#### *Abstract*
</center>
<div style="text-align: justify;">
La lettura delle cardiotografie CTGs, che sono registrazioni grafiche (tracciati) della frequenza cardiaca fetale durante la gravidanza, è soggetta a interpretazioni differenti quando viene eseguita da diversi operatori sanitari. 
Si tratta di una fase essenziale per valutare la salute del feto durante la gravidanza e il travaglio. Essa infatti influenza le decisioni sull'intervento del medico che, a seconda di come viene valutato il feto, opterà ad esempio per la somministrazione di ossigeno alla madre, o in casi più gravi, procederà con un taglio cesareo d'emergenza.

L'obiettivo di questa nostra analisi sarà costruire dei modelli in grado di prevedere con una buona accuratezza se il feto è Normale, Sospetto o Patologico.
I dati utilizzati sono stati estratti dal database di **SisPorto**, un programma di analisi automatizzata del tracciato cardiotografico che individua e quantifica, seguendo i criteri guida della FIGO (Federazione Internazionale di Ginecologia e Ostetricia), una serie di parametri rilevanti che vengono valutati durante il monitoraggio cardiotografico del feto.(((( NB segue breve spiegazione dei modelli utilizzati da completare)))) Utilizzeremo (((tot))) metodologie di classificazione per valutare e costruire il modello che più si adatta ai nostri dati: (((elenco))). (((Breve descrizione cronologica di quale modello si è fatto per primo, quale si è scartato ecc)))



Ulteriori dettagli sul dataset sono presenti al seguente link: [Fetal Health Classification-Kaggle](https://www.kaggle.com/datasets/andrewmvd/fetal-health-classification/data>)
<div style="text-align: justify;">
<br><br> 

### 1) Introduzione
<div style="text-align: justify;">
La riduzione della mortalità neonatale fa parte dei principi cardine dell'Agenda 2030 per lo sviluppo sostenibile. Sottoscritta nel 2015 dai governi dei 193 membri delle Nazioni Unite, fra gli obiettivi che si prefigge vi è quello di porre fine alle morti prevenibili di neonati e bambini sotto i 5 anni di età. In particolare viene richiesto che tutti i paesi dovranno cercare di ridurre la mortalità neonatale ad almeno 12 per ogni 1000 abitanti nati vivi. Ad oggi però sono più di 60 gli stati lontani da questo traguardo e 2.3 milioni di neonati muoiono ogni anno.
Di questi 904 400 neonati sopravvivono solo pochi giorni a causa di complicanze alla nascita, e oltre un milione sono quelli che muoiono durante il parto. 
La maggior parte di questi decessi sono causati dalla scarsa qualità dell’assistenza prima e durante il parto. Il miglioramento dei servizi sanitari e il potenziamento dei supporti informatici a costi accessibili,quindi, sono punti chiave per arginare queste tragedie.<br><br>
Fatte queste premesse, non si può non considerare la cardiotografia computerizzata CTGc vista la posizione di primaria importanza che occupa nel fornire l'ausilio al monitoraggio della salute del feto. Essa infatti è stata introdotta con l’obiettivo di ridurre i falsi positivi e la soggettività dell’interpretazione poichè fornisce un’interpretazione oggettiva della
CTG consentendo la comunicazione di numeri piuttosto che di opinioni. Negli anni infatti ci si è resi conto che i risultati pratici conseguiti dall’uso «di massa» della cardiotocografia sono stati di gran lunga inferiori alle aspettative a causa della carenza di criteri univoci di interpretazione e a scarsa preparazione degli operatori sanitari.

<div style="text-align: justify;">

### 2) Materiali
<div style="text-align: justify;">
I dati di interesse sono stati estratti dal dataset **fetal_health**,esportabile gratuitamente dal link sopracitato. Si tratta di un dataset con 2126 osservazioni di cardiotografie fetali suddivise per 21 variabili a cui si somma l'etichetta di classe *fetal_health* rappresentata dalle seguenti modalità: 1,2,3 che indicano rispettivamente uno stato di salute del feto Normale, Sospetto, Patologico. Per completezza di informazione segue una tabella che riporta sinteticamente la descrizione e le modalità dell variabili:

<div style="text-align: justify;">
VARIABILE     | DESCRIZIONE  | MODALITÀ 
------------- | -------------| ---------
baseline_value| Valore di base della frequenza cardiaca fetale (FHR) |  Bpm
accelerations|Conteggio delle accelerazioni medie dalla FHR | Hz
fetal_movement|Presenza media di movimenti fetali| Hz                
uterine_contractions| Numero di contrazioni uterine| Hz
light_decelerations|Numero di decelerazioni leggere della FHR|Hz            
severe_decelerations|Numero di decelerazioni gravi della FHR|Hz          
prolongued_decelerations|Numero di decelerazioni prolungate della FHR|Hz |    
abnormal_short_term_variability|Presenza di variabilità a breve termine anormale|Binario (0 o 1)|
mean_value_of_short_term_variability| Valore medio della variabilità a breve termine|Numerico|  
percentage_of_time_with_abnormal_long_term...| Percentuale di tempo con variabilità a lungo termine anormale | Percentuale                      
mean_value_of_long_term_variability| Valore medio della variabilità a lungo termine| Numerico   
histogram_width| Larghezza dell'istogramma della FHR| Numerico                         
histogram_min| Valore minimo dell'istogramma della FHR| Numerico                         
histogram_max| Valore massimo dell'istogramma della FHR| Numerico| 
histogram_number_of_peaks| Numero di picchi nell'istogramma della FHR| Numerico (conteggio)|
histogram_number_of_zeroes| Numero di zeri nell'istogramma della FHR| Numerico (conteggio)|
histogram_mode | Modalità dell'istogramma della FHR | Numerico|
histogram_mean                                | Valore medio dell'istogramma della FHR                      | Numerico                         |
| histogram_median                              | Mediana dell'istogramma della FHR                           | Numerico                         |
| histogram_variance                            | Varianza dell'istogramma della FHR                          | Numerico                         |
| histogram_tendency                            | Asimmetria dell'istogramma della FHR  | **-1**: sinistra **0**:simmetrica **1**:destra  |
| fetal_health                                  | Salute fetale (etichetta di classe)                         |**1**: Sano **2**:Sospetto **3**:Patologico     |                      
                 
<div style="text-align: justify;">
Il dataset non presenta valori mancanti. Valutando la distribuzione delle variabili abbiamo visto come quelle di conteggio naturalmente seguono una distribuzione assimilabile a quella di Poisson di conseguenza si è optato ad escluderle dalle successive analisi assieme alle variabili che dimostravano una pronunciata asimmetria. È stata esclusa anche la variabile histogram_tendency poichè fattoriale. 
Da un'analisi preliminare dell'istogramma delle frequenze relative condizionato per classi si evince come la classe dei sani è predominante:
<br><br>
```{r, echo=FALSE,fig.align='center', fig.width=6,fig.height=4}
fetal_Health <- tibble(read.csv("fetal_health.csv")) %>%
  mutate_at(vars(fetal_health),as.factor) # non è elegante da migliorare
levels(fetal_Health$fetal_health) <- c("Normale","Sospetto","Patologico")
fetal_Health <- fetal_Health %>%
  select(-c(severe_decelerations,
            histogram_number_of_zeroes,
            histogram_number_of_peaks,
            histogram_variance,
            histogram_tendency, 
            percentage_of_time_with_abnormal_long_term_variability, 
            accelerations, 
            fetal_movement,
            prolongued_decelerations))

etichette<-fetal_Health$fetal_health

fetal_Health %>%
ggplot(aes(x=fetal_health,
                y= after_stat(count)/sum(after_stat(count)))) + 
  geom_bar(aes(fill = fetal_health), color="black") +         
  labs(x="Condizione del feto", y="Frequenza Relativa") 
```
<div style="text-align: justify;">
          
### 3) Analisi esplorativa
<div style="text-align: justify;">
In prima analisi abbiamo deciso di analizzare la correlazione mediante ggpairs. Se ne è dedotto che histogram_mean, histogram_median e histogram_mode sono fortemente correlate. Si nota come le variabili anche se distinte per fetal_health sono multimodali quindi successivamente ci serviremo della MDA. Inoltre essendo dati presi da macchine, quindi "data entry",è improbabile la presenza di outliers.
<br><br>
```{r, echo=FALSE,fig.align='center', fig.width=6,fig.height=4}

```
Procediamo ora con l'analisi delle componenti principali. Anzitutto, visto l'ordine di di grandezza differente fra le variabili abbiamo eseguito una standardizzazione. Con la PCA abbiamo ottenuto che 4 componenti coprono l'80% della variabilità. A questo punto abbiamo selezionato le prime 4 variabili in base ai loadings (cioè quanto peso ha la singola variabile all'interno della componente principale).
Dopodichè abbiamo fatto un ggpairs delle variabili selezionate. Dal grafico si nota che
le ultime 2 variabili sezionate (mean_value_of_long_term_variability e uterine_contractions)
non rispettano la normalità e la simmetria in tutti i gruppi.((((ggpairs))))
```{r, echo=FALSE,fig.align='center', fig.width=6,fig.height=4}

```
Inoltre dallo scatterplot delle prime 2 variabili si evince una netta distinzione tra i gruppi così come segue:
<br><br>
```{r, echo=FALSE,fig.align='center', fig.width=6,fig.height=4}
fetal_Health %>%
  ggplot(mapping = aes(x=histogram_mean , y = histogram_max, color = fetal_health)) +
  geom_point()

```
è evidente come i sospetti sul grafico si collocano a destra dei sani e non tra sani e malati, difatti i cardiotogrammi dei feti sospetti sono quelli cui parametri si discostano dalla normalità e che necessitano di ulteriori approfondimenti. 

<div style="text-align: justify;">


### 4.1) Model Based Clustering
<div style="text-align: justify;">
Ora che
<div style="text-align: justify;">

### 4.2) Model Based Classification
<div style="text-align: justify;">
((((((((()))))))))
<div style="text-align: justify;">
```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.






## Classification 



